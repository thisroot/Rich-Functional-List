!function(){"use strict";function a(){$("."+f.triggerClass).off("click",b).on("click",b)}function b(){$(this).toggleClass(f.triggerRotClass)}function c(){$("."+f.titleContentClass+", ."+f.itemContentClass).click(function(){var a,b=$(this).text();$(this).off(),$(this).html(""),$("<textarea></textarea>").attr({"class":"textbox",cols:40,rows:3}).appendTo(this).focus().html(b).focusout(function(){a=$(this).val(),$(this).parent().html(a),$(this).remove()}),$(this).focusout(function(){c(),f.domUpdate.call(this)}),f.stateUpdate()})}function d(a){var b=a.originalEvent.touches?a.originalEvent.touches[0]:a;j.floating&&(a.preventDefault(),a.data.dragMove(b,a.data.list))}function e(a){var b=a.originalEvent.touches?a.originalEvent.touches[0]:a;j.floating&&(a.preventDefault(),a.data.dragStop(b,a.data.list,$(a.data)))}var f,g,h={listNode:"ul",itemNode:"li",listClass:"rfl-list",listTitle:"rfl-list-title",itemContentClass:"rfl-list-content",itemClass:"rfl-item",subItemClass:"rfl-subaccordion-item",titleContentClass:"rfl-title-content",titleItemClass:"rfl-title-card",triggerClass:"rfl-trigger",triggerItemClass:"rfl-trigger-item",triggerMainClass:"rfl-trigger-main",triggerRotClass:"",dragClass:"rfl-dragel",placeClass:"rfl-placeholder",openClass:"rfl-open",deleteClass:"rfl-delete",addClass:"rfl-add",addTitleClass:"rfl-add-title",handleClass:"rfl-handle",mainAccordionClass:"rfl-mainAccordion",subAccordionClass:"rfl-subAccordion",stateUpdate:function(){},domUpdate:function(){},newItemMarkup:"",openTriggerMarkup:"",subListMarkup:"",subListMarkupMain:"",mainTriggerMarkup:""},i={lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},j={floating:null,evTarget:null,underMouse:null,placeholder:null},k={amount:0,increase:function(){this.amount++}};$.fn.richFunctionalList=function(a){return g=this,f=$.extend({},h,a),j.placeholder=$('<div class="'+f.placeClass+'"></div>'),g.children().each(function(){$(this).addNextList()}),g.rflListeners($(this)),console.log(g.data()),this},$.fn.addNextList=function(){var a="list"+k.amount;g.data(a,new $.RichList(this,a)),k.increase()},$.fn.addNewList=function(){var a="list"+k.amount;this.data(a,new $.RichList(this.children(f.itemNode+":last"),a)),k.increase()},$.fn.rflListeners=function(b){a(),c()},$.fn.delAllEmptyListsTrigs=function(){$.each(this.data(),function(){if(this instanceof $.RichList){var a=$(this.list.$rootList[0]).children("."+f.mainAccordionClass);this.deleteEmptyListsTriggers(a)}})},$.fn.getNumberLists=function(){return k.amount},$.fn.animLocalArrows=function(){this.each(function(){$(this).on("click",function(){$(this).toggleClass("fa-rotate-90")})})},$.fn.expand=function(a){var b=$(this).closest("."+f.itemClass),c=b.next("."+f.subItemClass).children("."+f.subAccordionClass);return a?(c.show(),f.domUpdate.call(this)):void(c.hasClass(f.openClass)||$(this).doExpand(c))},$.fn.collapse=function(a){var b=$(this).closest("."+f.itemClass),c=b.next("."+f.subItemClass).children("."+f.subAccordionClass);return a?(c.hide(),f.domUpdate.call(this)):void(c.hasClass(f.openClass)&&$(this).doCollapse(c))},$.fn.doExpand=function(a){a.addClass(f.openClass),a.slideDown({duration:350,queue:!1,progress:function(){f.domUpdate.call(this)}})},$.fn.doCollapse=function(a){a.slideUp({duration:350,queue:!1,progress:function(){f.domUpdate.call(this)}}),a.removeClass(f.openClass)},$.fn.expandTitle=function(a){var b=$(this).closest("."+f.triggerItemClass),c=b.children("."+f.subAccordionClass);return a?(c.show(),f.domUpdate.call(this)):void(c.hasClass(f.openClass)||(c.addClass(f.openClass),$(this).doExpand(c)))},$.RichList=function(a,b){this.list={$rootList:$(a),listName:b,$triggers:$(a).find("."+f.triggerClass)},this.initFirstTrigger(),this.initInnerTriggers(),this.handleListeners(),this.addItemListener(),this.deleteItemListener()},$.RichList.prototype.newListListeners=function(a,b,c){c.parents().each(function(){if(b!==a){var c=g.data("list"+b),d=$(c.list.$rootList[0]).children("."+f.mainAccordionClass);c.deleteEmptyListsTriggers(d),c.list.$triggers=c.list.$rootList.find("."+f.triggerClass),c.resetItems(),c.resetMouse(),c.list.$triggers.off(),c.initInnerTriggers(),c.initFirstTrigger(),c.list.$triggers.animLocalArrows(),c.handleListeners()}})},$.RichList.prototype.handleListeners=function(){var a=this;a.list.$rootList.find("."+f.handleClass).off(),$(document).off("touchmove mousemove",d),$(document).off("touchend touchcancel mouseup",e),this.list.$rootList.find("."+f.handleClass).on("touchstart mousedown",function(b){var c=b.originalEvent.touches?b.originalEvent.touches[0]:b;b.preventDefault(),a.dragStart(c,a.list),$(document).on("touchmove mousemove",a,d).on("touchend touchcancel mouseup",a,e)})},$.RichList.prototype.addItemListener=function(){var a=this;this.list.$rootList.find("."+f.addClass).unbind().click(function(){saveState.listsChanged=!0;var b=$(this).parents("."+f.itemClass),c=b.next("."+f.subItemClass).children(f.listNode);a.addItem(b,c,!1)}),this.list.$rootList.find("."+f.addTitleClass).unbind().click(function(){saveState.listsChanged=!0;var b=$(this).parents("."+f.triggerItemClass),c=b.children(f.listNode);a.addItem(b,c,!0)})},$.RichList.prototype.deleteItemListener=function(){this.list.$rootList.find("."+f.deleteClass).unbind().click(function(){function a(a){if(a){var b=c.parents("."+f.titleItemClass).length?c.parents("."+f.titleItemClass).parent("."+f.listTitle):c.parents("."+f.itemClass);saveState.listsChanged=!0,1===b.parent("."+f.mainAccordionClass).children("."+f.itemClass).length?(b.parent("."+f.mainAccordionClass).prev("."+f.titleItemClass).children().remove("."+f.triggerClass),b.parent("."+f.mainAccordionClass).remove()):1===b.parent("."+f.subAccordionClass).children("."+f.itemClass).length&&(b.parent("."+f.subAccordionClass).parent("."+f.subItemClass).prev("."+f.listTitle).children().remove("."+f.triggerClass),b.parent("."+f.subAccordionClass).parent("."+f.subItemClass).prev("."+f.listTitle).removeClass(f.listTitle),b.parent("."+f.subAccordionClass).parent("."+f.subItemClass).remove(),b.parent("."+f.subAccordionClass).remove()),b.next("."+f.subItemClass).children(f.listNode).find("*").remove(),b.next("."+f.subItemClass).children(f.listNode).remove(),b.next("."+f.subItemClass).remove(),b.find("*").remove(),b.remove(),f.domUpdate.call(this)}}var b,c=$(this);b=window.confirm("Are you sure you want to delete this card & all its children?"),b&&a(!0)})},$.RichList.prototype.resetItems=function(){var a={floating:null,evTarget:null,underMouse:null};j=$.extend({},j,a)},$.RichList.prototype.floatItem=function(a,b){this.createFloat(a),this.getChildren(a,b),this.appendPlaceholder(a),$(document.body).append(j.floating)},$.RichList.prototype.createFloat=function(a){j.floating=$(document.createElement(f.itemNode)).addClass(f.listClass+" "+f.dragClass),j.floating.css("width",a.outerWidth(!0))},$.RichList.prototype.floatItemPosition=function(a){j.floating.css({left:a.pageX-j.floating.outerWidth(!0)+25,top:a.pageY-25})},$.RichList.prototype.getChildren=function(a,b){a.next().is("."+f.subItemClass)?(a.next().children("."+f.openClass).removeClass(f.openClass),a.children("."+f.triggerClass).removeClass(f.triggerRotClass),a.children("."+f.triggerClass).collapse(a.parentsUntil(!0)),j.floating.contents=a.next(),this.removeEmptyParentList(b)):j.floating.contents=!1},$.RichList.prototype.removeEmptyParentList=function(a){var b=a.prev("."+f.listTitle);b.length&&!a.children(f.itemNode).length&&(b.children("."+f.triggerClass).remove(),b.removeClass(f.listTitle),a.remove())},$.RichList.prototype.appendPlaceholder=function(a){j.placeholder.css("height",a.outerHeight()),a.after(j.placeholder),a.remove(),j.floating.append(a)},$.RichList.prototype.buildSublist=function(a,b){return a.children("."+f.itemContentClass).after(f.openTriggerMarkup),b?(a.append(f.subListMarkupMain),a.addClass(f.listTitle),a.children("."+f.titleItemClass).children(".buttons-title").after(function(){return f.mainTriggerMarkup}),a.find("."+f.triggerMainClass).addClass(f.triggerRotClass),a.children(f.listNode)):(a.after(f.subListMarkup),a.addClass(f.listTitle),a.next())},$.RichList.prototype.openList=function(a,b,c){b.hasClass(f.openClass)||(c?(a.expandTitle(),b.children("."+f.subAccordionClass).addClass(f.openClass),a.children("."+f.titleItemClass).find("."+f.triggerClass).addClass(f.triggerRotClass)):(a.expand(),b.children("."+f.subAccordionClass).addClass(f.openClass),a.children("."+f.triggerClass).addClass(f.triggerRotClass)))},$.RichList.prototype.addItem=function(a,b,d){b.length?(this.openList(a,b,d),b.prepend(f.newItemMarkup)):(b=this.buildSublist(a,d),this.list.$triggers.off(),this.list.$triggers=this.list.$rootList.find("."+f.triggerClass),this.initInnerTriggers(),this.initFirstTrigger(),this.list.$triggers.animLocalArrows(),this.openList(a,b,d),d?b.prepend(f.newItemMarkup):b.children("."+f.subAccordionClass).prepend(f.newItemMarkup)),c(),this.deleteItemListener(),this.addItemListener(),this.handleListeners(),b.find(".rfl-list-content:first").trigger("click"),f.domUpdate.call(this)},$.RichList.prototype.dragStart=function(a,b){var c=$(a.target),d=c.closest("."+f.triggerItemClass);j.evTarget=c.closest("."+f.itemClass),i.lastX=a.pageX,i.lastY=a.pageY,this.floatItem(j.evTarget,d),this.floatItemPosition(a),f.stateUpdate(),this.list.$triggers.off(),f.domUpdate.call(this)},$.RichList.prototype.dragStop=function(a,b){var d=j.floating.children(f.itemNode).first(),e=($(this.list.$rootList[0]).children("."+f.mainAccordionClass),this.list.$rootList.data("list-number")),h=j.placeholder.parents("li[data-list-number]").data("list-number");j.placeholder.replaceWith(d),j.floating.contents&&d.after(j.floating.contents),j.floating.remove(),c(),g.delAllEmptyListsTrigs(),this.resetItems(),this.resetMouse(),this.list.$triggers.animLocalArrows(),this.initInnerTriggers(),this.initFirstTrigger(),this.newListListeners(e,h,d),this.handleListeners(),this.deleteItemListener(),this.addItemListener(),f.domUpdate.call(this),f.domUpdate.call(g.data("list"+h))},$.RichList.prototype.dragMove=function(a,b){var c,d=$(this.list.$rootList[0]).children("."+f.mainAccordionClass),e=j.placeholder.parents("li[data-list-number]").data("list-number");this.floatItemPosition(a),this.deleteEmptyListsTriggers(d),this.mousePositionCalc(a),c=this.mouseNewAx(),this.mouseDistMoved(c),this.itemUnderCursor(a),this.moveHorizontal(),this.moveVertical(a),f.domUpdate.call(this),f.domUpdate.call(g.data("list"+e))},$.RichList.prototype.resetMouse=function(){i={lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.list.$triggers=this.list.$rootList.find("."+f.triggerClass)},$.RichList.prototype.mousePositionCalc=function(a){i.lastX=i.nowX,i.lastY=i.nowY,i.nowX=a.pageX,i.nowY=a.pageY,i.distX=i.nowX-i.lastX,i.distY=i.nowY-i.lastY,i.lastDirX=i.dirX,i.lastDirY=i.dirY,i.dirX=0===i.distX?0:i.distX>0?1:-1,i.dirY=0===i.distY?0:i.distY>0?1:-1},$.RichList.prototype.mouseNewAx=function(){return Math.abs(i.distX)>Math.abs(i.distY)?1:0},$.RichList.prototype.mouseDistMoved=function(a){i.dirAx!==a?(i.distAxX=0,i.distAxY=0):(i.distAxX+=Math.abs(i.distX),0!==i.dirX&&i.dirX!==i.lastDirX&&(i.distAxX=0),i.distAxY+=Math.abs(i.distY),0!==i.dirY&&i.dirY!==i.lastDirY&&(i.distAxY=0)),i.dirAx=a},$.RichList.prototype.itemUnderCursor=function(a){if(j.underMouse=$(document.elementFromPoint(a.pageX-document.body.scrollLeft,a.pageY-(window.pageYOffset||document.documentElement.scrollTop))),j.underMouse.hasClass(f.placeClass))return void(j.underMouse=!1);if(j.underMouse.hasClass(f.itemClass)&&j.underMouse.hasClass(f.subItemClass))this.checkPrev();else{var b=j.underMouse.closest("."+f.itemClass+", ."+f.subItemClass);b.length?(j.underMouse=b,this.checkPrev()):j.underMouse=!1}},$.RichList.prototype.checkPrev=function(){j.underMouse.hasClass(f.subItemClass)&&j.underMouse.children("."+f.subAccordionClass).hasClass(f.openClass)?j.underMouse=j.underMouse.find("."+f.itemClass+":first"):j.underMouse.hasClass(f.subItemClass)&&(j.underMouse=j.underMouse.prev("."+f.itemClass))},$.RichList.prototype.moveVertical=function(a){if(!i.dirAx&&j.underMouse&&j.underMouse.length){var b=a.pageY<j.underMouse.offset().top+j.underMouse.height()/2,c=j.underMouse.hasClass(f.listTitle);!c&&b?j.underMouse.before(j.placeholder):c||b?c&&b?j.underMouse.before(j.placeholder):c&&!b&&j.underMouse.next("."+f.subItemClass).after(j.placeholder):j.underMouse.after(j.placeholder)}},$.RichList.prototype.moveHorizontal=function(){if(i.dirAx&&i.distAxX>=35){var a=j.placeholder.prevAll("."+f.itemClass+":first");if(i.distAxX=0,a.hasClass(f.listTitle)&&!a.next("."+f.subItemClass).children("."+f.subAccordionClass).hasClass(f.openClass))a.expand(!0),a.next("."+f.subItemClass).children("."+f.subAccordionClass).prepend(j.placeholder),a.children("."+f.triggerClass).addClass("fa-rotate-90"),a.next("."+f.subItemClass).children("."+f.subAccordionClass).addClass(f.openClass);else if(a.hasClass(f.listTitle)&&a.next("."+f.subItemClass).children("."+f.subAccordionClass).hasClass(f.openClass))a.next("."+f.subItemClass).children("."+f.subAccordionClass).prepend(j.placeholder),a.children("."+f.triggerClass).addClass("fa-rotate-90"),a.next("."+f.subItemClass).children("."+f.subAccordionClass).addClass(f.openClass);else if(a&&!a.hasClass(f.listTitle)){var b=f.subListMarkup;a.addClass(f.listTitle),a.append(f.openTriggerMarkup),a.after(b),a.next("."+f.subItemClass).children("."+f.subAccordionClass).prepend(j.placeholder)}}},$.RichList.prototype.initFirstTrigger=function(){this.list.$triggers.first().bind("click",function(){var a=$(this).closest("."+f.triggerItemClass),b=a.children("."+f.subAccordionClass);b.hasClass(f.openClass)?$(this).doCollapse(b):$(this).doExpand(b)})},$.RichList.prototype.initInnerTriggers=function(){this.list.$triggers.not(":first").bind("click",function(){var a=$(this).closest("."+f.itemClass),b=a.next("."+f.subItemClass).children("."+f.subAccordionClass);b.hasClass(f.openClass)?$(this).doCollapse(b):$(this).doExpand(b)})},$.RichList.prototype.deleteEmptyListsTriggers=function(a){var b=a.find("."+f.listTitle);b.each(function(){var a=$(this).next("."+f.subItemClass).children(f.listNode);a.each(function(){if(!$(this).children().length){var a=$(this).parent("."+f.subItemClass).prev("."+f.listTitle);a.children().remove("."+f.triggerClass),a.removeClass(f.listTitle),$(this).parent("."+f.subItemClass).remove(),$(this).remove()}})})}}();